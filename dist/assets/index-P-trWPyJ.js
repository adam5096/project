import{J as h,d as ee,r as c,c as le,G as ae,e as d,o as te,f as oe,g as l,w as a,h as s,C as v,j as f,m as j,F as ne,z as $,K as R,p as re,k as se,_ as ie}from"./index-nEBEK9n6.js";import{u as de}from"./setting-ciC8X26n.js";const ue=(o,y,u)=>h.get(`/admin/acl/role/${o}/${y}/?roleName=${u}`),pe=o=>o.id?h.put("/admin/acl/role/update",o):h.post("/admin/acl/role/save",o),ce=o=>h.get("/admin/acl/permission/toAssign/"+o),me=(o,y)=>h.post(`/admin/acl/permission/doAssign/?roleId=${o}&permissionId=${y}`),fe=o=>h.delete("/admin/acl/role/remove/"+o),_e=o=>(re("data-v-8bb20f02"),o=o(),se(),o),ge=_e(()=>j("h4",null,"分配選單與按鈕權限",-1)),ve={style:{flex:"auto"}},ye=ee({__name:"index",setup(o){let y=de(),u=c(1),w=c(10),g=c(""),V=c([]),S=c(0),m=c(!1),x=c(),_=c(!1),i=le({roleName:""}),I=c([]),z=c([]),N=c();ae(()=>{b()});const b=async(n=1)=>{u.value=n;let e=await ue(u.value,w.value,g.value);e.code==200&&(S.value=e.data.total,V.value=e.data.records)},E=()=>{b()},O=()=>{b(),g.value=""},T=()=>{y.refsh=!y.refsh},B=()=>{m.value=!0,Object.assign(i,{roleName:"",id:0}),$(()=>{x.value.clearValidate()})},K=n=>{m.value=!0,Object.assign(i,n),$(()=>{x.value.clearValidate()})},L={roleName:[{required:!0,trigger:"blur",validator:(n,e,r)=>{e.trim().length>=2?r():r(new Error("職位名稱至少兩字元或以上"))}}]},M=async()=>{await x.value.validate(),(await pe(i)).code==200&&(R({type:"success",message:i.id?"修改 成功":"新增 成功"}),m.value=!1,b(i.id?u.value:1))},D=async n=>{_.value=!0,Object.assign(i,n);let e=await ce(i.id);e.code==200&&(z.value=e.data),I.value=U(z.value,[])},F={children:"children",label:"name"},U=(n,e)=>(n.forEach(r=>{r.select&&r.level==4&&e.push(r.id),r.children&&r.children.length>0&&U(r.children,e)}),e),H=async()=>{const n=i.id;let e=N.value.getCheckedKeys(),r=N.value.getHalfCheckedKeys(),C=e.concat(r);(await me(n,C)).code==200&&(_.value=!1,R({type:"success",message:"分配權限 成功"}),window.location.reload())},G=async n=>{(await fe(n)).code==200&&R({type:"success",message:"刪除職位 成功"}),b(V.value.length>1?u.value:u.value-1)};return(n,e)=>{const r=d("el-input"),C=d("el-form-item"),p=d("el-button"),q=d("el-form"),A=d("el-card"),k=d("el-table-column"),J=d("el-popconfirm"),Q=d("el-table"),W=d("el-pagination"),X=d("el-dialog"),Y=d("el-tree"),Z=d("el-drawer");return te(),oe(ne,null,[l(A,null,{default:a(()=>[l(q,{inline:!0,class:"form"},{default:a(()=>[l(C,{label:"職位搜尋"},{default:a(()=>[l(r,{placeholder:"請輸入職位搜尋關鍵字",modelValue:s(g),"onUpdate:modelValue":e[0]||(e[0]=t=>v(g)?g.value=t:g=t)},null,8,["modelValue"])]),_:1}),l(C,null,{default:a(()=>[l(p,{type:"primary",size:"default",plain:"",disabled:!s(g),onClick:O},{default:a(()=>[f("搜尋")]),_:1},8,["disabled"]),l(p,{type:"primary",size:"default",plain:"",onClick:T},{default:a(()=>[f("重置當前畫面")]),_:1})]),_:1})]),_:1})]),_:1}),l(A,{style:{margin:"10px 0px"}},{default:a(()=>[l(p,{type:"primary",size:"default",icon:"Plus",plain:"",onClick:B},{default:a(()=>[f("新增職位")]),_:1}),l(Q,{border:"",style:{margin:"10px 0px"},data:s(V)},{default:a(()=>[l(k,{type:"index",align:"center",label:"#"}),l(k,{align:"center",label:"ID",prop:"id"}),l(k,{align:"center",label:"職位名稱","show-overflow-tooltip":"",prop:"roleName"}),l(k,{align:"center",label:"建立時間","show-overflow-tooltip":"",prop:"createTime"}),l(k,{align:"center",label:"更新時間","show-overflow-tooltip":"",prop:"updateTime"}),l(k,{align:"center",label:"操作",width:"280px"},{default:a(({row:t})=>[l(p,{type:"primary",size:"small",icon:"User",plain:"",onClick:P=>D(t)},{default:a(()=>[f("分配權限")]),_:2},1032,["onClick"]),l(p,{type:"warning",size:"small",icon:"Edit",plain:"",onClick:P=>K(t)},{default:a(()=>[f("編輯")]),_:2},1032,["onClick"]),l(J,{title:`確定刪除 ${t.roleName}?`,width:"260px",onConfirm:P=>G(t.id)},{reference:a(()=>[l(p,{type:"danger",size:"small",icon:"Delete",plain:""},{default:a(()=>[f("刪除")]),_:1})]),_:2},1032,["title","onConfirm"])]),_:1})]),_:1},8,["data"]),l(W,{"current-page":s(u),"onUpdate:currentPage":e[1]||(e[1]=t=>v(u)?u.value=t:u=t),"page-size":s(w),"onUpdate:pageSize":e[2]||(e[2]=t=>v(w)?w.value=t:w=t),"page-sizes":[5,10,20,40],background:!0,layout:" prev, pager, next, jumper,->, sizes,total,",total:s(S),onCurrentChange:b,onSizeChange:E},null,8,["current-page","page-size","total"])]),_:1}),l(X,{modelValue:s(m),"onUpdate:modelValue":e[5]||(e[5]=t=>v(m)?m.value=t:m=t),title:s(i).id?"修改職位":"新增職位"},{footer:a(()=>[l(p,{type:"primary",size:"default",plain:"",onClick:e[4]||(e[4]=t=>v(m)?m.value=!1:m=!1)},{default:a(()=>[f("取消")]),_:1}),l(p,{type:"primary",size:"default",plain:"",onClick:M},{default:a(()=>[f("確定")]),_:1})]),default:a(()=>[l(q,{model:s(i),rules:L,ref_key:"form",ref:x},{default:a(()=>[l(C,{label:"職位名稱",prop:"roleName"},{default:a(()=>[l(r,{placeholder:"請輸入職位名稱",modelValue:s(i).roleName,"onUpdate:modelValue":e[3]||(e[3]=t=>s(i).roleName=t)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),l(Z,{modelValue:s(_),"onUpdate:modelValue":e[7]||(e[7]=t=>v(_)?_.value=t:_=t)},{header:a(()=>[ge]),default:a(()=>[l(Y,{ref_key:"tree",ref:N,data:s(z),"show-checkbox":"","node-key":"id","default-expand-all":"","default-checked-keys":s(I),props:F},null,8,["data","default-checked-keys"])]),footer:a(()=>[j("div",ve,[l(p,{onClick:e[6]||(e[6]=t=>v(_)?_.value=!1:_=!1),plain:""},{default:a(()=>[f("取消")]),_:1}),l(p,{type:"primary",onClick:H,plain:""},{default:a(()=>[f("確定")]),_:1})])]),_:1},8,["modelValue"])],64)}}}),we=ie(ye,[["__scopeId","data-v-8bb20f02"]]);export{we as default};
