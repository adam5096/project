import{u as ie}from"./setting-HKO2olnI.js";import{J as k,d as pe,r as i,c as me,G as ce,e as m,o as R,f as T,g as e,w as t,h as n,C,j as p,t as D,m as S,v as F,n as fe,F as M,q as ge,z as $,K as x,p as ve,k as _e,_ as ye}from"./index-abAMUYV-.js";const we=(s,d,_)=>k.get(`/admin/acl/user/${s}/${d}/?username=${_}`),be=s=>s.id?k.put("/admin/acl/user/update",s):k.post("/admin/acl/user/save",s),Ve=s=>k.get("/admin/acl/user/toAssign/"+s),he=s=>k.post("/admin/acl/user/doAssignRole",s),Ce=s=>k.delete("/admin/acl/user/remove/"+s),ke=s=>k.delete("/admin/acl/user/batchRemove",{data:s}),Ue=s=>(ve("data-v-443af10e"),s=s(),_e(),s),xe={style:{flex:"auto"}},ze=Ue(()=>S("h4",null,"分配角色(職位)",-1)),Re={style:{flex:"auto"}},Se=pe({__name:"index",setup(s){let d=i(1),_=i(5),E=i(0),z=i([]),f=i(!1),g=i(!1),U=i([]),y=i([]),r=me({username:"",name:"",password:""}),q=i([]),w=i(),b=i(""),j=ie();ce(()=>{V()});const V=async(o=1)=>{d.value=o;let l=await we(d.value,_.value,b.value);l.code==200&&(E.value=l.data.total,z.value=l.data.records)},G=()=>{V()},H=()=>{f.value=!0,Object.assign(r,{username:"",name:"",password:""}),$(()=>{w.value.clearValidate("username"),w.value.clearValidate("name"),w.value.clearValidate("password")})},J=o=>{f.value=!0,Object.assign(r,o),$(()=>{w.value.clearValidate("username"),w.value.clearValidate("name")})},K=async()=>{await w.value.validate(),(await be(r)).code==200?(f.value=!1,x({type:"success",message:r.id?"更新 成功":"新增 成功"}),window.location.reload()):(f.value=!1,x({type:"error",message:r.id?"更新 失敗":"新增 失敗"}))},Q=()=>{f.value=!1},W={username:[{required:!0,trigger:"blur",validator:(o,l,u)=>{l.trim().length>=5?u():u(new Error("名稱 的長度5位或以上"))}}],name:[{required:!0,trigger:"blur",validator:(o,l,u)=>{l.trim().length>=5?u():u(new Error("暱稱 的長度5位或以上"))}}],password:[{required:!0,trigger:"blur",validator:(o,l,u)=>{l.trim().length>=5?u():u(new Error("密碼 的長度6位或以上"))}}]},X=async o=>{Object.assign(r,o);let l=await Ve(r.id);console.log("result",l),l.code==200&&(U.value=l.data.allRolesList,y.value=l.data.assignRoles,g.value=!0)},I=i(!1),N=i(!0),Y=o=>{y.value=o?U.value:[],N.value=!1},Z=o=>{I.value=o.length===U.value.length,N.value=o.length!==U.value.length},ee=async()=>{let o={userId:r.id,roleIdList:y.value.map(u=>u.id)};(await he(o)).code==200&&(x({type:"success",message:"分配職務成功"}),g.value=!1,V(d.value))},le=async o=>{(await Ce(o)).code==200&&(x({type:"success",message:"刪除 成功"}),V(z.value.length>1?d.value:d.value-1))},ae=o=>{q.value=o},te=async()=>{let o=q.value.map(u=>u.id);(await ke(o)).code==200&&(x({type:"success",message:"批量刪除 成功"}),V(z.value.length>1?d.value:d.value-1))},oe=()=>{V(),b.value=""},ne=()=>{j.refsh=!j.refsh};return(o,l)=>{const u=m("el-input"),h=m("el-form-item"),c=m("el-button"),A=m("el-form"),L=m("el-card"),v=m("el-table-column"),re=m("el-popconfirm"),se=m("el-table"),ue=m("el-pagination"),O=m("el-drawer"),B=m("el-checkbox"),de=m("el-checkbox-group");return R(),T(M,null,[e(L,{style:{height:"60px"}},{default:t(()=>[e(A,{inline:!0,class:"form"},{default:t(()=>[e(h,{label:"使用者"},{default:t(()=>[e(u,{placeholder:"請輸入搜尋名稱",modelValue:n(b),"onUpdate:modelValue":l[0]||(l[0]=a=>C(b)?b.value=a:b=a)},null,8,["modelValue"])]),_:1}),e(h,null,{default:t(()=>[e(c,{type:"primary",size:"default",disabled:!n(b),onClick:oe},{default:t(()=>[p("搜尋現有使用者")]),_:1},8,["disabled"]),e(c,{type:"primary",size:"default",onClick:ne},{default:t(()=>[p("重置當前畫面")]),_:1})]),_:1})]),_:1})]),_:1}),e(L,{style:{margin:"10px 0px"}},{default:t(()=>[e(c,{type:"primary",size:"default",onClick:H},{default:t(()=>[p("新增使用者")]),_:1}),e(c,{type:"danger",size:"default",disabled:!n(q).length,onClick:te},{default:t(()=>[p("批量刪除")]),_:1},8,["disabled"]),e(se,{onSelectionChange:ae,style:{margin:"10px 0px"},border:"",data:n(z)},{default:t(()=>[e(v,{type:"selection",align:"center"}),e(v,{label:"#",align:"center",type:"index"}),e(v,{label:"ID",align:"center",prop:"id"}),e(v,{label:"使用者名稱",align:"center",prop:"username","show-overflow-tooltip":""}),e(v,{label:"使用者暱稱",align:"center",prop:"name","show-overflow-tooltip":""}),e(v,{label:"使用者角色",align:"center",prop:"roleName","show-overflow-tooltip":""}),e(v,{label:"建立時間",align:"center",prop:"createTime","show-overflow-tooltip":""}),e(v,{label:"更新時間",align:"center",prop:"updateTime","show-overflow-tooltip":""}),e(v,{label:"操作",width:"300px",align:"center"},{default:t(({row:a})=>[e(c,{plain:"",type:"primary",size:"small",icon:"User",onClick:P=>X(a)},{default:t(()=>[p("分配角色")]),_:2},1032,["onClick"]),e(c,{plain:"",type:"warning",size:"small",icon:"Edit",onClick:P=>J(a)},{default:t(()=>[p("編輯")]),_:2},1032,["onClick"]),e(re,{title:`確定刪除 ${a.username}?`,width:"260px",onConfirm:P=>le(a.id)},{reference:t(()=>[e(c,{plain:"",type:"danger",size:"small",icon:"Delete"},{default:t(()=>[p("刪除")]),_:1})]),_:2},1032,["title","onConfirm"])]),_:1})]),_:1},8,["data"]),e(ue,{"current-page":n(d),"onUpdate:currentPage":l[1]||(l[1]=a=>C(d)?d.value=a:d=a),"page-size":n(_),"onUpdate:pageSize":l[2]||(l[2]=a=>C(_)?_.value=a:_=a),"page-sizes":[5,10,20,40],background:!0,layout:" prev, pager, next, jumper,->, sizes,total",total:n(E),onCurrentChange:V,onSizeChange:G},null,8,["current-page","page-size","total"])]),_:1}),e(O,{modelValue:n(f),"onUpdate:modelValue":l[6]||(l[6]=a=>C(f)?f.value=a:f=a)},{header:t(()=>[S("h4",null,D(n(r).id?"更新 使用者":"新增 使用者"),1)]),default:t(()=>[e(A,{model:n(r),rules:W,ref_key:"formRef",ref:w},{default:t(()=>[e(h,{label:"使用者名稱",prop:"username"},{default:t(()=>[e(u,{placeholder:"請輸入使用者 名稱",modelValue:n(r).username,"onUpdate:modelValue":l[3]||(l[3]=a=>n(r).username=a)},null,8,["modelValue"])]),_:1}),e(h,{label:"使用者暱稱",prop:"name"},{default:t(()=>[e(u,{placeholder:"請輸入使用者 暱稱",modelValue:n(r).name,"onUpdate:modelValue":l[4]||(l[4]=a=>n(r).name=a)},null,8,["modelValue"])]),_:1}),n(r).id?fe("",!0):(R(),F(h,{key:0,label:"使用者密碼",prop:"password"},{default:t(()=>[e(u,{placeholder:"請輸入密碼",modelValue:n(r).password,"onUpdate:modelValue":l[5]||(l[5]=a=>n(r).password=a)},null,8,["modelValue"])]),_:1}))]),_:1},8,["model"])]),footer:t(()=>[S("div",xe,[e(c,{plain:"",type:"primary",onClick:Q},{default:t(()=>[p("放棄變更")]),_:1}),e(c,{plain:"",type:"warning",onClick:K},{default:t(()=>[p("確認並儲存變更")]),_:1})])]),_:1},8,["modelValue"]),e(O,{modelValue:n(g),"onUpdate:modelValue":l[11]||(l[11]=a=>C(g)?g.value=a:g=a)},{header:t(()=>[ze]),default:t(()=>[e(A,null,{default:t(()=>[e(h,{label:"使用者名稱"},{default:t(()=>[e(u,{modelValue:n(r).username,"onUpdate:modelValue":l[7]||(l[7]=a=>n(r).username=a),disabled:!0},null,8,["modelValue"])]),_:1}),e(h,{label:"職位列表"},{default:t(()=>[e(B,{onChange:Y,modelValue:I.value,"onUpdate:modelValue":l[8]||(l[8]=a=>I.value=a),indeterminate:N.value},{default:t(()=>[p("全選")]),_:1},8,["modelValue","indeterminate"]),e(de,{modelValue:n(y),"onUpdate:modelValue":l[9]||(l[9]=a=>C(y)?y.value=a:y=a),onChange:Z},{default:t(()=>[(R(!0),T(M,null,ge(n(U),a=>(R(),F(B,{key:a.id,label:a},{default:t(()=>[p(D(a.roleName),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),footer:t(()=>[S("div",Re,[e(c,{type:"primary",plain:"",onClick:l[10]||(l[10]=a=>C(g)?g.value=!1:g=!1)},{default:t(()=>[p("放棄變更")]),_:1}),e(c,{type:"warning",plain:"",onClick:ee},{default:t(()=>[p("確認並儲存變更")]),_:1})])]),_:1},8,["modelValue"])],64)}}}),je=ye(Se,[["__scopeId","data-v-443af10e"]]);export{je as default};
